add_namespace = GEX
add_namespace = GEXTXS
add_namespace = GEXGEA
add_namespace = GEXAOG
add_namespace = GEXTXS
add_namespace = GEXOTT
add_namespace = GEX_foreign

# Main German capitulation event
country_event = {
	id = GEX.1
	title = GEX.1.t
	desc = GEX.1.d
	picture = GFX_report_event_german_reichstag_bombed

	fire_only_once = yes

	trigger = {
		tag = GER
		is_subject = no
		has_war = yes
		OR = {
			surrender_progress > 0.8
			AND = {
				NOT = { controls_state = 64 } #Brandenburg
				surrender_progress > 0.75
			}
			NOT = {
				controls_state = 28 #Elsass-Lothringen
				controls_state = 51 #Ostrheinland
				controls_state = 55 #Hessen
				controls_state = 50 #Wurttemberg
				controls_state = 52 #Oberbayern
				controls_state = 59 #Hannover
			}
			AND = {
				NOT = {
					controls_state = 5 #Ostpreussen
					controls_state = 66 #Niederschlesien
					controls_state = 86 #Posen
					controls_state = 62 #Pommern
					controls_state = 64 #Brandenburg
				}
				OR = {
					NOT = {
						controls_state = 55 #Hessen
						controls_state = 51 #Ostrheinland
						controls_state = 28 #Elsass-Lothringen
					}
					NOT = {
						controls_state = 52 #Oberbayern
						controls_state = 55 #Hessen
						controls_state = 60 #Thuringen
					}
				}
			}
		}
	}

	immediate = {
		log = "[GetDateText]: [Root.GetName]: event GEX.1"
		
		hidden_effect = {
			add_ideas = GEX_flight_of_the_reich
			
			if = {
				limit = {
					TXS = {
						is_in_faction_with = GER
					}
				}
				set_global_flag = TEX_GEX_candidate
			}

			if = { #Checking for UoB involvement in the war
				limit = {
					ENG = {
						is_in_faction_with = FRA
						has_war_with = GER
						OR = {
							any_war_score > 10
							controls_state = 56
							controls_state = 58
							controls_state = 59
						}
					}
				}
				set_global_flag = UoB_war_par_1
			}
			if = {
				limit = {
					ENG = {
						is_in_faction_with = FRA
						has_war_with = GER
						OR = {
							any_war_score > 25
							AND = {
								controls_state = 5
								controls_state = 62
								controls_state = 86
							}
							controls_state = 64
						}
					}
				}
				set_global_flag = UoB_war_par_2
			}

			random_other_country = {
				limit = { has_war_with = GER }
				news_event = worldnews.145
				country_event = worldtension.25
			}

			LEC = {
				country_event = {
					id = lec.100
					days = 1
				}
			}
			
			every_country = {
				limit = { is_subject_of = GER }
				overlord = {
					set_autonomy = {
						target = PREV
						autonomy_state = autonomy_free
					}
				}
				
			}
			
			every_other_country = {
				limit = {
					OR = {
						is_in_faction_with = GER
						is_subject_of = GER
					}
				}
				set_country_flag = former_reichspakt_member
				if = {
					limit = {
						
					}
					add_timed_idea = {
						idea = GEX_fleeing_exiles
						days = 365
					}
				}
			}
			
			AUS = {
				if = {
					limit = {
						NOT = { has_war_with = GER }
					}
					add_timed_idea = {
						idea = GEX_fleeing_exiles
						days = 365
					}
				}
			}
		}
	}

	option = {
		name = GEX.1.a #Assume control of Mittelafrika. We shall fight on from there
		trigger = {#Does Germany flee to TXS?
			GEX_can_flee_TXS = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_africa
		custom_effect_tooltip = TXS_player_becomes_GEX
		hidden_effect = {
			TXS = { country_event = GEXTXS.1 }
		}
	}
	
	option = {
		name = GEX.1.b #Assume control of GEA
		trigger = {
			GEX_can_flee_GEA = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_asia
		custom_effect_tooltip = GEA_player_becomes_GEX
		hidden_effect = {
			GEA = { country_event = GEXGEA.1 }
		}
	}
	
	option = {
		name = GEX.1.c #Assume control of AOG
		trigger = {
			GEX_can_flee_AOG = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_china
		custom_effect_tooltip = AOG_player_becomes_GEX
		hidden_effect = {
			AOG = { country_event = GEXAOG.1 }
		}
	}
	
	option = {
		name = GEX.1.e #Flee to Texas
		trigger = {
			GEX_can_flee_TXS = YES
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_texas
		custom_effect_tooltip = TXS_player_becomes_GEX
		hidden_effect = {
			TXS = { country_event = GEXTXS.1 }
		}
	}
	option = {
		name = GEX.1.f #Flee to Ottomans
		trigger = {
			GEX_can_flee_OTT = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_turkey
		custom_effect_tooltip = OTT_player_becomes_GEX
		hidden_effect = {
			OTT = { country_event = GEXOTT.1 }
		}
	}
	option = {
		name = GEX.1.g #There is nowhere to run. Surrender!
		trigger = {
			NOT = { has_global_flag = GER_flees_to_africa }
		}
		log = "		-- Germany is capitulating completely, no exile"
		set_country_flag = GER_capitulated
		custom_effect_tooltip = GER_will_capitulate
		hidden_effect = {
			country_event = GEX.22
		}
	}
}

country_event = {
	id = GEXMAF.1
	immediate = { log = "[GetDateText]: [Root.GetName]: event GEXMAF.1" }
	title = GEXMAF.1.t
	desc = GEXMAF.1.d
	picture = GFX_report_event_german_reichstag_bombed

	is_triggered_only = yes

	option = {
		name = GEXMAF.1.a #Lapdogs no longer! Declare the independence of the Mittelafrikan Empire!
		add_stability = -0.3
		overlord = {
			set_autonomy = {
				target = MAF
				autonomy_state = autonomy_free
			}
		}
		if = {
			limit = { is_in_faction = yes }
			leave_faction = yes
		}
		GER = {
			country_event = capt.3
		}
	}

	option = {
		name = GEXMAF.1.b #Welcome the exiled government and give in to their demands
		custom_effect_tooltip = MAF_player_becomes_GEX
		GER = {
			country_event = capt.4
			change_tag_from = MAF
		}
	}
}