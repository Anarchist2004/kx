add_namespace = GEX
add_namespace = GEXTXS
add_namespace = GEXGEA
add_namespace = GEXAOG
add_namespace = GEXTXS
add_namespace = GEXOTT
add_namespace = GEX_foreign

# Main German capitulation event
country_event = {
	id = GEX.1
	title = GEX.1.t
	desc = GEX.1.d
	picture = GFX_report_event_german_reichstag_bombed

	fire_only_once = yes

	trigger = {
		tag = GER
		is_subject = no
		has_war = yes
		OR = {
			surrender_progress > 0.8
			AND = {
				NOT = { controls_state = 64 } #Brandenburg
				surrender_progress > 0.75
			}
			NOT = {
				controls_state = 28 #Elsass-Lothringen
				controls_state = 51 #Ostrheinland
				controls_state = 55 #Hessen
				controls_state = 50 #Wurttemberg
				controls_state = 52 #Oberbayern
				controls_state = 59 #Hannover
			}
			AND = {
				NOT = {
					controls_state = 5 #Ostpreussen
					controls_state = 66 #Niederschlesien
					controls_state = 86 #Posen
					controls_state = 62 #Pommern
					controls_state = 64 #Brandenburg
				}
				OR = {
					NOT = {
						controls_state = 55 #Hessen
						controls_state = 51 #Ostrheinland
						controls_state = 28 #Elsass-Lothringen
					}
					NOT = {
						controls_state = 52 #Oberbayern
						controls_state = 55 #Hessen
						controls_state = 60 #Thuringen
					}
				}
			}
		}
	}

	immediate = {
		log = "[GetDateText]: [Root.GetName]: event GEX.1"
		
		hidden_effect = {
			add_ideas = GEX_flight_of_the_reich
			
			if = {
				limit = {
					TXS = {
						is_in_faction_with = GER
					}
				}
				set_global_flag = TEX_GEX_candidate
			}

			if = { #Checking for UoB involvement in the war
				limit = {
					ENG = {
						is_in_faction_with = FRA
						has_war_with = GER
						OR = {
							any_war_score > 10
							controls_state = 56
							controls_state = 58
							controls_state = 59
						}
					}
				}
				set_global_flag = UoB_war_par_1
			}
			if = {
				limit = {
					ENG = {
						is_in_faction_with = FRA
						has_war_with = GER
						OR = {
							any_war_score > 25
							AND = {
								controls_state = 5
								controls_state = 62
								controls_state = 86
							}
							controls_state = 64
						}
					}
				}
				set_global_flag = UoB_war_par_2
			}

			random_other_country = {
				limit = { has_war_with = GER }
				news_event = worldnews.145
				country_event = worldtension.25
			}

			LEC = {
				country_event = {
					id = lec.100
					days = 1
				}
			}
			
			every_country = {
				limit = { is_subject_of = GER }
				overlord = {
					set_autonomy = {
						target = PREV
						autonomy_state = autonomy_free
					}
				}
				
			}
			
			every_other_country = {
				limit = {
					OR = {
						is_in_faction_with = GER
						is_subject_of = GER
					}
				}
				set_country_flag = former_reichspakt_member
				if = {
					limit = {
						
					}
					add_timed_idea = {
						idea = GEX_fleeing_exiles
						days = 365
					}
				}
			}
			
			AUS = {
				if = {
					limit = {
						NOT = { has_war_with = GER }
					}
					add_timed_idea = {
						idea = GEX_fleeing_exiles
						days = 365
					}
				}
			}
			
			if = {
				limit = {
					GER = { is_ai = yes }
				}
				german_ai_flees = yes
			}
		}
	}

	option = {
		name = GEX.1.a #Assume control of Mittelafrika. We shall fight on from there
		trigger = {#Does Germany flee to MAF?
			is_ai = no
			GEX_can_flee_MAF = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_africa
		custom_effect_tooltip = MAF_player_becomes_GEX
		hidden_effect = {
			MAF = { country_event = GEX.2 }
		}
	}
	
	option = {
		name = GEX.1.b #Assume control of GEA
		trigger = {
			is_ai = no
			GEX_can_flee_GEA = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_asia
		custom_effect_tooltip = GEA_player_becomes_GEX
		hidden_effect = {
			GEA = { country_event = GEX.2 }
		}
	}
	
	option = {
		name = GEX.1.c #Assume control of AOG
		trigger = {
			is_ai = no
			GEX_can_flee_AOG = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_china
		custom_effect_tooltip = AOG_player_becomes_GEX
		hidden_effect = {
			AOG = { country_event = GEX.2 }
		}
	}
	
	option = {
		name = GEX.1.e #Flee to Texas
		trigger = {
			is_ai = no
			GEX_can_flee_TXS = YES
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_texas
		custom_effect_tooltip = TXS_player_becomes_GEX
		hidden_effect = {
			TXS = { country_event = GEX.2 }
		}
	}
	option = {
		name = GEX.1.f #Flee to Ottomans
		trigger = {
			is_ai = no
			GEX_can_flee_OTT = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_turkey
		custom_effect_tooltip = OTT_player_becomes_GEX
		hidden_effect = {
			OTT = { country_event = GEX.2 }
		}
	}
	option = {
		name = GEX.1.g #There is nowhere to run. Surrender!
		trigger = {
			is_ai = no
			GEX_can_flee_MAF = no
			GEX_can_flee_GEA = no
			GEX_can_flee_AOG = no
			GEX_can_flee_TXS = no
			GEX_can_flee_OTT = no
		}
		log = "		-- Germany is capitulating completely, no exile"
		set_country_flag = GER_capitulated
		custom_effect_tooltip = GER_will_capitulate
		swap_ideas = {
			add_idea = GEX_flight_of_the_reich_2
			remove_idea = GEX_flight_of_the_reich
		}
		germany_capitulates = yes
	}
	option = {
		name = GEX.1.h #Ai script
		trigger = {
			is_ai = yes
		}
		german_ai_flees = yes
	}
}

country_event = {
	id = GEX.2
	immediate = { log = "[GetDateText]: [Root.GetName]: event GEX.2" }
	title = {
		text = GEXMAF.2.t
		trigger = {
			tag = MAF
		}
	}
	desc = {
		text = GEX.2.d.MAF
		trigger = {
			tag = MAF
			NOT = {
				has_country_leader = {
					name = "Alexander Douala Manga-Bell"
					ruling_only = yes
				}
			}
		}
	}
	desc = {
		text = GEX.2.d.MAF_kaiser
		trigger = {
			tag = MAF
			has_country_leader = {
				name = "Alexander Douala Manga-Bell"
				ruling_only = yes
			}
		}
	}
	desc = {
		text = GEX.2.d.GEA
		trigger = {
			tag = GEA
		}
	}
	desc = {
		text = GEX.2.d.AOG
		trigger = {
			tag = AOG
			NOT = {
				has_cosmetic_tag = AOG_CHINA_REICH
				has_country_flag = AOG_krupp_flag
			}
		}
	}
	desc = {
		text = GEX.2.d.AOG_directors
		trigger = {
			tag = AOG
			has_country_flag = AOG_krupp_flag
		}
	}
	desc = {
		text = GEX.2.d.AOG_kaiser
		trigger = {
			tag = AOG
			has_cosmetic_tag = AOG_CHINA_REICH
		}
	}
	desc = {
		text = GEX.2.d.TXS
		trigger = {
			tag = TXS
		}
	}
	desc = {
		text = GEX.2.d.OTT
		trigger = {
			tag = OTT
		}
	}
	picture = GFX_report_event_german_reichstag_bombed

	is_triggered_only = yes
	
	option = {
		name = GEXMAF.2.a #Welcome the exiled government and give in to their demands
		custom_effect_tooltip = MAF_player_becomes_GEX
		GER = {
			country_event = capt.4
			change_tag_from = MAF
		}
	}
	
	option = {#no
		name = {
			text = GEX.2.b
			trigger = {
				NOT = { tag = MAF }
			}
		}
		name = { #Lapdogs no longer! Declare the independence of the Mittelafrikan Empire!
			text = GEX.2.b.MAF
			trigger = {
				tag = MAF
				NOT = {
					has_country_leader = {
						name = "Jomo Kenyatta"
						ruling_only = yes
					}
				}
			}
		}
		name = { #Kenyatta
			text = GEX.2.b.MAF_Kenyatta
			trigger = {
				tag = AOG
				has_country_leader = {
					name = "Jomo Kenyatta"
					ruling_only = yes
				}
			}
		}
		
		set_country_flag = GEX_rejected_exiles
		
		add_stability = -0.3
		if = {
			limit = { is_in_faction = yes }
			leave_faction = yes
		}
		GER = {
			country_event = GEX.3
		}
	}
}
	
# FROM has refused to surrender to the fleeing Germans
country_event = {
	id = GEX.3
	immediate = { log = "[GetDateText]: [Root.GetName]: event GEX.3" }
	title = {
		text = GEX.3.t.MAF
		trigger = {
			FROM = { tag = MAF }
		}
	}
	title = {
		text = GEX.3.t.GEA
		trigger = {
			FROM = { tag = GEA }
		}
	}
	title = {
		text = GEX.3.t.AOG
		trigger = {
			FROM = { tag = AOG }
		}
	}
	title = {
		text = GEX.3.t.TXS
		trigger = {
			FROM = { tag = TXS }
		}
	}
	title = {
		text = GEX.3.t.OTT
		trigger = {
			FROM = { tag = OTT }
		}
	}
	desc = {
		text = GEX.3.d.MAF
		trigger = {
			FROM = { tag = MAF }
		}
	}
	desc = {
		text = GEX.3.d.GEA
		trigger = {
			FROM = { tag = GEA }
		}
	}
	desc = {
		text = GEX.3.d.AOG
		trigger = {
			FROM = { tag = AOG }
		}
	}
	desc = {
		text = GEX.3.d.TXS
		trigger = {
			FROM = { tag = TXS }
		}
	}
	desc = {
		text = GEX.3.d.OTT
		trigger = {
			FROM = { tag = OTT }
		}
	}
	picture = GFX_report_event_MAF_tanganyika

	is_triggered_only = yes

	option = {
		name = GEX.3.a #Assume control of Mittelafrika. We shall fight on from there
		trigger = {#Does Germany flee to MAF?
			is_ai = no
			GEX_can_flee_MAF = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_africa
		custom_effect_tooltip = MAF_player_becomes_GEX
		hidden_effect = {
			MAF = { country_event = GEX.2 }
		}
	}
	
	option = {
		name = GEX.3.b #Assume control of GEA
		trigger = {
			is_ai = no
			GEX_can_flee_GEA = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_asia
		custom_effect_tooltip = GEA_player_becomes_GEX
		hidden_effect = {
			GEA = { country_event = GEX.2 }
		}
	}
	
	option = {
		name = GEX.3.c #Assume control of AOG
		trigger = {
			is_ai = no
			GEX_can_flee_AOG = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_china
		custom_effect_tooltip = AOG_player_becomes_GEX
		hidden_effect = {
			AOG = { country_event = GEX.2 }
		}
	}
	
	option = {
		name = GEX.3.e #Flee to Texas
		trigger = {
			is_ai = no
			GEX_can_flee_TXS = YES
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_texas
		custom_effect_tooltip = TXS_player_becomes_GEX
		hidden_effect = {
			TXS = { country_event = GEX.2 }
		}
	}
	option = {
		name = GEX.3.f #Flee to Ottomans
		trigger = {
			is_ai = no
			GEX_can_flee_OTT = yes
		}
		set_country_flag = GER_capitulated
		set_global_flag = GER_flees_to_turkey
		custom_effect_tooltip = OTT_player_becomes_GEX
		hidden_effect = {
			OTT = { country_event = GEX.2 }
		}
	}
	option = {
		name = GEX.3.g #There is nowhere to run. Surrender!
		trigger = {
			is_ai = no
			GEX_can_flee_MAF = no
			GEX_can_flee_GEA = no
			GEX_can_flee_AOG = no
			GEX_can_flee_TXS = no
			GEX_can_flee_OTT = no
		}
		log = "		-- Germany is capitulating completely, no exile"
		set_country_flag = GER_capitulated
		custom_effect_tooltip = GER_will_capitulate
		swap_ideas = {
			add_idea = GEX_flight_of_the_reich_2
			remove_idea = GEX_flight_of_the_reich
		}
		germany_capitulates = yes
	}
	option = {
		name = GEX.3.h #Ai script
		trigger = {
			is_ai = yes
		}
		german_ai_flees = yes
	}
}

# MAF has agreed to take in the fleeing Germans
country_event = {
	id = GEX.4
	immediate = { log = "[GetDateText]: [Root.GetName]: event GEX.4" }
	title = {
		text = GEX.4.t.MAF
		trigger = {
			FROM = { tag = MAF }
		}
	}
	title = {
		text = GEX.4.t.GEA
		trigger = {
			FROM = { tag = GEA }
		}
	}
	title = {
		text = GEX.4.t.AOG
		trigger = {
			FROM = { tag = AOG }
		}
	}
	title = {
		text = GEX.4.t.TXS
		trigger = {
			FROM = { tag = TXS }
		}
	}
	title = {
		text = GEX.4.t.OTT
		trigger = {
			FROM = { tag = OTT }
		}
	}
	desc = {
		text = GEX.4.d.MAF
		trigger = {
			FROM = { tag = MAF }
		}
	}
	desc = {
		text = GEX.4.d.GEA
		trigger = {
			FROM = { tag = GEA }
		}
	}
	desc = {
		text = GEX.4.d.AOG
		trigger = {
			FROM = { tag = AOG }
		}
	}
	desc = {
		text = GEX.4.d.TXS
		trigger = {
			FROM = { tag = TXS }
		}
	}
	desc = {
		text = GEX.4.d.OTT
		trigger = {
			FROM = { tag = OTT }
		}
	}
	picture = GFX_report_event_MAF_tanganyika

	is_triggered_only = yes

	option = {
		name = GEX.4.a
		trigger = {
			FROM = { tag = MAF }
		}
		custom_effect_tooltip = MAF_player_becomes_GEX
		hidden_effect = {
			swap_ideas = {
				add_idea = GEX_flight_of_the_reich_2
				remove_idea = GEX_flight_of_the_reich
			}
			FROM = {
				germany_flees_to_exile = yes
			}
		}
	}
	
	option = {
		name = GEX.4.b
		trigger = {
			FROM = { tag = GEA }
		}
		custom_effect_tooltip = GEA_player_becomes_GEX
		hidden_effect = {
			swap_ideas = {
				add_idea = GEX_flight_of_the_reich_2
				remove_idea = GEX_flight_of_the_reich
			}
			FROM = {
				germany_flees_to_exile = yes
			}
		}
	}
	
	option = {
		name = GEX.4.c
		trigger = {
			FROM = { tag = AOG }
		}
		custom_effect_tooltip = AOG_player_becomes_GEX
		hidden_effect = {
			swap_ideas = {
				add_idea = GEX_flight_of_the_reich_2
				remove_idea = GEX_flight_of_the_reich
			}
			FROM = {
				germany_flees_to_exile = yes
			}
		}
	}
	
	option = {
		name = GEX.4.e
		trigger = {
			FROM = { tag = TEX }
		}
		custom_effect_tooltip = TEX_player_becomes_GEX
		hidden_effect = {
			swap_ideas = {
				add_idea = GEX_flight_of_the_reich_2
				remove_idea = GEX_flight_of_the_reich
			}
			FROM = {
				germany_flees_to_exile = yes
			}
		}
	}
	
	option = {
		name = GEX.4.f
		trigger = {
			FROM = { tag = OTT }
		}
		custom_effect_tooltip = OTT_player_becomes_GEX
		hidden_effect = {
			swap_ideas = {
				add_idea = GEX_flight_of_the_reich_2
				remove_idea = GEX_flight_of_the_reich
			}
			FROM = {
				germany_flees_to_exile = yes
			}
		}
	}
}