increase_kuban_collapse = {
	custom_effect_tooltip = increase_kuban_collapse_tt
	add_to_variable = { KUB_collapse_var = 1 }
	if = {
		limit = {
			check_variable = {
				var = KUB_collapse_var
				value = 4
				compare = greater_than_or_equals
			}
		}
		complete_national_focus = KUB_Foes_And_Friends
		hidden_effect = {
			country_event = {
				id = kub.100
				days = 3
			}
		}
	}
}
decrease_kuban_collapse = {
	add_to_variable = { KUB_collapse_var = -1 }
}
KUB_increase_lineytsy = {
	add_power_balance_value = {
		id = KUB_rada_bop
		value = 0.05
	}
	set_temp_variable_to_random = {
		var = KUB_pop_added
		min = 0.01
		max = 0.06
	}
	if = {
		limit = { has_country_flag = KUB_chernomortsy_authoritarian }
		add_popularity = {
			ideology = social_conservative
			popularity = KUB_pop_added
		}
		else = {
			add_popularity = {
				ideology = authoritarian_democrat
				popularity = KUB_pop_added
			}
		}
	}
}
KUB_increase_chernomortsy = {
	add_power_balance_value = {
		id = KUB_rada_bop
		value = -0.05
	}
	set_temp_variable_to_random = {
		var = KUB_pop_added
		min = 0.01
		max = 0.06
	}
	if = {
		limit = { has_country_flag = KUB_chernomortsy_authoritarian }
		add_popularity = {
			ideology = authoritarian_democrat
			popularity = KUB_pop_added
		}
	}
	else_if = {
		limit = { has_country_flag = KUB_chernomortsy_socdem }
		add_popularity = {
			ideology = social_democrat
			popularity = KUB_pop_added
		}
	}
	else = {
		add_popularity = {
			ideology = social_liberal
			popularity = KUB_pop_added
		}
	}
}

KUB_remove_ukrainian_sentiments = {
	if = {
		limit = { has_idea = KUB_Unification_Sentiments_2 }
		remove_ideas = KUB_Unification_Sentiments_2
	}
	if = {
		limit = { has_idea = KUB_Unification_Sentiments_1 }
		remove_ideas = KUB_Unification_Sentiments_1
	}
	if = {
		limit = { has_idea = KUB_Unification_Sentiments }
		remove_ideas = KUB_Unification_Sentiments
	}
	if = {
		limit = { has_non_aggression_pact_with = UKR }
		diplomatic_relation = {
			country = UKR
			relation = non_aggression_pact
			active = no
		}
	}
	if = {
		limit = { has_military_access_to = UKR }
		diplomatic_relation = {
			country = UKR
			relation = military_access
			active = no
		}
		diplomatic_relation = {
			country = UKR
			relation = docking_rights
			active = no
		}
	}
	if = {
		limit = { gives_military_access_to = UKR }
		UKR = {
			diplomatic_relation = {
				country = PREV
				relation = military_access
				active = no
			}
			diplomatic_relation = {
				country = PREV
				relation = docking_rights
				active = no
			}
		}
	}
	if = {
		limit = { is_guaranteed_by = UKR }
		UKR = {
			diplomatic_relation = {
				country = PREV
				relation = guarantee
				active = no
			}
		}
	}	
}
KUB_increase_ukrainian_cooperation = {
	if = {
		limit = { has_idea = KUB_Unification_Sentiments_1 }
		UKR = { UKR_increase_kuban_cooperation = yes }
		swap_ideas = {
			remove_idea = KUB_Unification_Sentiments_1
			add_idea = KUB_Unification_Sentiments_2
		}
		add_opinion_modifier = {
			target = UKR
			modifier = KR_close_allies
		}
		reverse_add_opinion_modifier = {
			target = UKR
			modifier = KR_close_allies
		}
	}
	else_if = {
		limit = { has_idea = KUB_Unification_Sentiments }
		swap_ideas = {
			remove_idea = KUB_Unification_Sentiments
			add_idea = KUB_Unification_Sentiments_1
		}
		UKR = { UKR_increase_kuban_cooperation = yes }
		give_military_access = UKR
		UKR = {
			diplomatic_relation = {
				country = KUB
				relation = docking_rights
				active = yes
			}
		}
		add_opinion_modifier = {
			target = UKR
			modifier = KR_pleased
		}
		reverse_add_opinion_modifier = {
			target = UKR
			modifier = KR_pleased
		}
	}
	else_if = {
		limit = {
			NOT = { has_idea = KUB_Unification_Sentiments }
		}
		add_ideas = KUB_Unification_Sentiments
	}
}
# requires a temp variable KUB_integration_process_change
KUB_change_integration_process = {
	if = {
		limit = { KUB_has_unification_sentiments = yes }
		# convert percent to absolute
		if = {
			limit = {
				check_variable = { KUB_integration_process_change > -1 }
				check_variable = { KUB_integration_process_change < 1 }
			}
			multiply_temp_variable = { KUB_integration_process_change = 100 }
		}

		# tooltip
		effect_tooltip = {
			add_to_variable = {
				KUB.Integration_Process = KUB_integration_process_change
				tooltip = KUB_integration_process_tooltip
			}
		}

		# lower limit = legitimacy * -1
		set_temp_variable = { KUB_lower_limit = KUB.Integration_Process }
		multiply_temp_variable = { KUB_lower_limit = -1 }

		# upper limit = 100 - legitimacy
		set_temp_variable = { KUB_upper_limit = 100 }
		subtract_from_temp_variable = { KUB_upper_limit = KUB.Integration_Process }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = KUB_integration_process_change
			min = KUB_lower_limit
			max = KUB_upper_limit
		}

		# add the variable
		add_to_variable = { KUB.Integration_Process = KUB_integration_process_change }
	}
}
UKR_increase_kuban_cooperation = {
	if = {
		limit = { has_idea = UKR_KUB_Convention }
		swap_ideas = {
			remove_idea = UKR_KUB_Convention
			add_idea = UKR_KUB_Convention_2
		}
		if = {
			limit = {
				NOT = { has_guaranteed = KUB } 
			}
			give_guarantee = KUB
		}
	}
	else_if = {
		limit = { 
			NOT = { has_idea = UKR_KUB_Convention }
			NOT = { has_idea = UKR_KUB_Convention_2 }
		}
		add_ideas = UKR_KUB_Convention
	}
}

setup_kuban_cooperation = {
	set_variable = { KUB_coop_global_building_slots_factor = 0.1 }
	set_variable = { KUB_coop_consumer_goods_factor = 0.25 }
	set_variable = { KUB_coop_industrial_capacity_factory = 0.05 }
	set_variable = { KUB_coop_production_factory_max_efficiency_factor = 0.1 }
	set_variable = { KUB_coop_line_change_production_efficiency_factor = 0.1 }
	set_variable = { KUB_coop_production_speed_buildings_factor = 0.1 }
	set_variable = { KUB_coop_trade_opinion = 0.25 }
	add_ideas = KUB_Powerful_Cooperation_Movement
	add_dynamic_modifier = { modifier = KUB_Powerful_Cooperation_Movement_modifier }	
}
remove_kuban_cooperation = {
	remove_ideas = KUB_Powerful_Cooperation_Movement
	hidden_effect = { 
		remove_dynamic_modifier = { modifier = KUB_Powerful_Cooperation_Movement_modifier }	
	}
}
setup_puppet_KUB = {
	KUB = {
		drop_cosmetic_tag = yes
		hidden_effect = {
			remove_targeted_decision = { target = GER decision = KUB_buy_infantry }
			remove_targeted_decision = { target = RUS decision = KUB_buy_infantry }
			remove_targeted_decision = { target = TRM decision = KUB_buy_infantry }
			remove_targeted_decision = { target = GER decision = KUB_buy_support }
			remove_targeted_decision = { target = RUS decision = KUB_buy_support }
			remove_targeted_decision = { target = TRM decision = KUB_buy_support }
			remove_targeted_decision = { target = GER decision = KUB_buy_artillery }
			remove_targeted_decision = { target = RUS decision = KUB_buy_artillery }
			remove_targeted_decision = { target = TRM decision = KUB_buy_artillery }
			remove_targeted_decision = { target = GER decision = KUB_buy_bombers }
			remove_targeted_decision = { target = RUS decision = KUB_buy_bombers }
			remove_targeted_decision = { target = TRM decision = KUB_buy_bombers }
			remove_targeted_decision = { target = GER decision = KUB_buy_fighters }
			remove_targeted_decision = { target = RUS decision = KUB_buy_fighters }
			remove_targeted_decision = { target = TRM decision = KUB_buy_fighters }
			remove_targeted_decision = { target = GER decision = KUB_buy_motorized }
			remove_targeted_decision = { target = RUS decision = KUB_buy_motorized }
			remove_targeted_decision = { target = TRM decision = KUB_buy_motorized }
			remove_targeted_decision = { target = GER decision = KUB_buy_tank }
			remove_targeted_decision = { target = RUS decision = KUB_buy_tank }
			remove_targeted_decision = { target = TRM decision = KUB_buy_tank }
			
			set_party_name = {
				ideology = radical_socialist
				name = KUB_radical_socialist_party
				long_name = KUB_radical_socialist_party_long
			}
			set_party_name = {
				ideology = social_democrat
				name = KUB_social_democrat_party
				long_name = KUB_social_democrat_party_long
			}
			create_country_leader = {
				name = "Sobraniye Aktsionerov Kubsoyuza"
				picture = "gfx/leaders/KUB/Portrait_KUB_kubsoyuz.png"
				expire = "1965.1.1"
				ideology = market_socialist_subtype
			}
			if = {
				limit = { has_country_flag = KUB_chernomortsy_authoritarian }
				set_party_name = {
					ideology = authoritarian_democrat
					name = KUB_authoritarian_democrat_party
					long_name = KUB_authoritarian_democrat_party_long
				}
				create_country_leader = {
					name = "Alexander Filimonov"
					desc = "POLITICS_ALEXANDER_FILIMONOV_DESC"
					picture = "gfx/leaders/KUB/Portrait_KUB_Alexander_Filimonov.png"
					expire = "1965.1.1"
					ideology = authdem_cossack_subtype
				}
				set_temp_variable = { KUB_moderate_to_extremist_value = party_popularity@authoritarian_democrat }
				set_temp_variable = { KUB_moderate_to_extremist_value_reverse = 0 }
				subtract_from_temp_variable = { var = KUB_moderate_to_extremist_value_reverse value = party_popularity@authoritarian_democrat }
				add_popularity = { ideology = authoritarian_democrat popularity = KUB_moderate_to_extremist_value_reverse }
				add_popularity = { ideology = social_liberal popularity = KUB_moderate_to_extremist_value }
			
				set_temp_variable = { KUB_moderate_to_extremist_value = party_popularity@social_conservative }
				divide_temp_variable = { KUB_moderate_to_extremist_value = 2 }
				add_popularity = { ideology = authoritarian_democrat popularity = KUB_moderate_to_extremist_value }
				divide_temp_variable = { KUB_moderate_to_extremist_value = -1 }
				add_popularity = { ideology = social_conservative popularity = KUB_moderate_to_extremist_value }
			}
		}
	}
	if = {
		limit = { has_socialist_government = no }
		uncomplete_national_focus = {
			focus = KUB_Revkom_In_Power
			uncomplete_children = yes
		}	
	}
	if = {
		limit = {
			OR = {
				AND = {
					tag = GER
					has_authoritarian_government = no
				}
				AND = {
					is_ukrainian_tag = yes
					has_dictatorship_government = no
				}
			}
		}
		KUB = {
			set_politics = {
				ruling_party = social_liberal
				elections_allowed = no
			}
			set_political_party = {
				ideology = social_liberal
				popularity = 40
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				AND = {
					tag = GER
					has_authoritarian_government = yes
				}
				AND = {
					is_ukrainian_tag = yes
					has_dictatorship_government = yes
				}
			}
		}
		KUB = {
			set_politics = {
				ruling_party = paternal_autocrat
				elections_allowed = no
			}
			set_political_party = {
				ideology = paternal_autocrat
				popularity = 40
			}
		}
	}	
	else_if = {
		limit = {
			tag = RUS
		}
		hidden_effect = {
			KUB = {
				clr_country_flag = KUB_ukrainian_language
				set_party_name = {
					ideology = social_liberal
					name = KUB_social_liberal_party
					long_name = KUB_social_liberal_party_long
				}
				set_party_name = {
					ideology = social_democrat
					name = KUB_social_democrat_party
					long_name = KUB_social_democrat_party_long
				}
				set_party_name = {
					ideology = paternal_autocrat
					name = KUB_paternal_autocrat_party
					long_name = KUB_paternal_autocrat_party_long
				}
			}
		}
		if = {
			limit = { has_socialist_government = no }
			KUB = {
				set_politics = {
					ruling_party = authoritarian_democrat
					elections_allowed = no
				}
				set_political_party = {
					ideology = authoritarian_democrat
					popularity = 40
				}
			}
		}
	}		
	else_if = {
		limit = { has_democratic_socialist_government = yes }
		KUB = {
			create_country_leader = {
				name = "Aleksey Avtonomov"
				picture = "gfx/leaders/KUB/Portrait_KUB_Aleksey_Avtonomov.png"
				expire = "1965.1.1"
				ideology = radsoc_red_junta_subtype
			}
			create_country_leader = {
				name = "Aleksey Avtonomov"
				picture = "gfx/leaders/KUB/Portrait_KUB_Aleksey_Avtonomov.png"
				expire = "1965.1.1"
				ideology = red_junta_subtype
			}
			set_party_name = {
				ideology = radical_socialist
				name = KUB_totalist_party
				long_name = KUB_totalist_party_long
			}	
		}
	}
	if = {
		limit = { is_ukrainian_tag = yes }
		KUB = {
			set_cosmetic_tag = KUB_ukraine
			set_country_flag = KUB_ukrainian_language
			set_party_name = {
				ideology = social_liberal
				name = KUB_chernomortsy_ukrainian_party
				long_name = KUB_chernomortsy_ukrainian_party_long
			}
			set_party_name = {
				ideology = social_democrat
				name = KUB_chernomortsy_ukrainian_party
				long_name = KUB_chernomortsy_ukrainian_party_long
			}
			set_party_name = {
				ideology = paternal_autocrat
				name = KUB_kpa_ukrainian_party
				long_name = KUB_kpa_ukrainian_party_long
			}
		}
	}
}
