increase_kuban_collapse = {
	custom_effect_tooltip = increase_kuban_collapse_tt
	add_to_variable = { KUB_collapse_var = 1 }
	if = {
		limit = {
			check_variable = {
				var = KUB_collapse_var
				value = 3
				compare = greater_than_or_equals
			}
		}
		complete_national_focus = KUB_Foes_And_Friends
		hidden_effect = {
			country_event = {
				id = kub.100
				days = 3
			}
		}
	}
}
decrease_kuban_collapse = {
	add_to_variable = { KUB_collapse_var = -1 }
}
KUB_increase_lineytsy = {
	add_power_balance_value = {
		id = KUB_rada_bop
		value = 0.10
	}
	set_temp_variable_to_random = {
		var = KUB_pop_added
		min = 0.01
		max = 0.06
	}
	add_popularity = {
		ideology = authoritarian_democrat
		popularity = KUB_pop_added
	}
}
KUB_increase_chernomortsy = {
	add_power_balance_value = {
		id = KUB_rada_bop
		value = -0.10
	}
	set_temp_variable_to_random = {
		var = KUB_pop_added
		min = 0.01
		max = 0.06
	}
	add_popularity = {
		ideology = social_liberal
		popularity = KUB_pop_added
	}
}

KUB_remove_ukrainian_sentiments = {
	if = {
		limit = { has_idea = KUB_Unification_Sentiments_2 }
		remove_ideas = KUB_Unification_Sentiments_2
	}
	if = {
		limit = { has_idea = KUB_Unification_Sentiments_1 }
		remove_ideas = KUB_Unification_Sentiments_1
	}
	if = {
		limit = { has_idea = KUB_Unification_Sentiments }
		remove_ideas = KUB_Unification_Sentiments
	}
	if = {
		limit = { has_non_aggression_pact_with = UKR }
		diplomatic_relation = {
			country = UKR
			relation = non_aggression_pact
			active = no
		}
	}
	if = {
		limit = { has_military_access_to = UKR }
		diplomatic_relation = {
			country = UKR
			relation = military_access
			active = no
		}
		diplomatic_relation = {
			country = UKR
			relation = docking_rights
			active = no
		}
	}
	if = {
		limit = { gives_military_access_to = UKR }
		UKR = {
			diplomatic_relation = {
				country = PREV
				relation = military_access
				active = no
			}
			diplomatic_relation = {
				country = PREV
				relation = docking_rights
				active = no
			}
		}
	}
	if = {
		limit = { is_guaranteed_by = UKR }
		UKR = {
			diplomatic_relation = {
				country = PREV
				relation = guarantee
				active = no
			}
		}
	}	
}
KUB_increase_ukrainian_cooperation = {
	if = {
		limit = { has_idea = KUB_Unification_Sentiments_1 }
		UKR = { UKR_increase_kuban_cooperation = yes }
		swap_ideas = {
			remove_idea = KUB_Unification_Sentiments_1
			add_idea = KUB_Unification_Sentiments_2
		}
		add_opinion_modifier = {
			target = UKR
			modifier = KR_pleased
		}
		UKR = {
			add_opinion_modifier = {
				target = KUB
				modifier = KR_pleased
			}
		}
	}
	else_if = {
		limit = { has_idea = KUB_Unification_Sentiments }
		swap_ideas = {
			remove_idea = KUB_Unification_Sentiments
			add_idea = KUB_Unification_Sentiments_1
		}
		UKR = { UKR_increase_kuban_cooperation = yes }
		give_military_access = UKR
		UKR = {
			diplomatic_relation = {
				country = KUB
				relation = docking_rights
				active = yes
			}
		}
		add_opinion_modifier = {
			target = UKR
			modifier = KR_pleased
		}
		UKR = {
			add_opinion_modifier = {
				target = KUB
				modifier = KR_pleased
			}
		}
	}
	else_if = {
		limit = {
			NOT = { has_idea = KUB_Unification_Sentiments }
		}
		add_ideas = KUB_Unification_Sentiments
	}
}
UKR_increase_kuban_cooperation = {
	if = {
		limit = { has_idea = UKR_KUB_Convention }
		swap_ideas = {
			remove_idea = UKR_KUB_Convention
			add_idea = UKR_KUB_Convention_2
		}
		if = {
			limit = {
				NOT = { has_guaranteed = KUB } 
			}
			give_guarantee = KUB
		}
	}
	else_if = {
		limit = { 
			NOT = { has_idea = UKR_KUB_Convention }
			NOT = { has_idea = UKR_KUB_Convention_2 }
		}
		add_ideas = UKR_KUB_Convention
	}
}


setup_kuban_cooperation = {
	set_variable = { KUB_coop_global_building_slots_factor = 0.1 }
	set_variable = { KUB_coop_consumer_goods_factor = 0.25 }
	set_variable = { KUB_coop_industrial_capacity_factory = 0.05 }
	set_variable = { KUB_coop_production_factory_max_efficiency_factor = 0.1 }
	set_variable = { KUB_coop_line_change_production_efficiency_factor = 0.1 }
	set_variable = { KUB_coop_production_speed_buildings_factor = 0.1 }
	set_variable = { KUB_coop_radsoc_drift = 0.01 }
	set_variable = { KUB_coop_marlib_drift = 0.01 }
	add_ideas = KUB_Powerful_Cooperation_Movement
	add_dynamic_modifier = { modifier = KUB_Powerful_Cooperation_Movement_modifier }	
}
remove_kuban_cooperation = {
	remove_ideas = KUB_Powerful_Cooperation_Movement
	hidden_effect = { 
		remove_dynamic_modifier = { modifier = KUB_Powerful_Cooperation_Movement_modifier }	
	}
}
	
KUB_recalculate_cooperation = {
	
	#Max influence effects at 50% popularity
	set_variable = { KUB_coop_influence_var = KUB.party_popularity@radical_socialist }
	add_to_variable = { KUB_coop_influence_var = KUB.party_popularity@market_liberal }
	clamp_variable = {
		var = KUB_coop_influence_var
		min = 0
		max = 0.5
	}
	set_variable = { KUB.KUB_coop_consumer_goods_factor = KUB_coop_influence_var }
	
	set_temp_variable = { KUB_coop_positive_factor = KUB_coop_influence_var }
	multiply_temp_variable = { KUB_coop_positive_factor = 3 }

	set_variable = { KUB.KUB_coop_industrial_capacity_factory = 0.2 }
	multiply_variable = { KUB.KUB_coop_industrial_capacity_factory = KUB_coop_positive_factor }
	
	set_variable = { KUB.KUB_coop_production_factory_max_efficiency_factor = 0.4 }
	multiply_variable = { KUB.KUB_coop_production_factory_max_efficiency_factor = KUB_coop_influence_var }
	set_variable = { KUB.KUB_coop_line_change_production_efficiency_factor = 0.4 }
	multiply_variable = { KUB.KUB_coop_line_change_production_efficiency_factor = KUB_coop_influence_var }
	set_variable = { KUB.KUB_coop_production_speed_buildings_factor = 0.4 }
	multiply_variable = { KUB.KUB_coop_production_speed_buildings_factor = KUB_coop_influence_var }
	
	set_variable = { KUB.KUB_coop_radsoc_drift = 0.01 }
	multiply_variable = { KUB.KUB_coop_radsoc_drift = KUB_coop_influence_var }
	set_variable = { KUB.KUB_coop_marlib_drift = 0.01 }
	multiply_variable = { KUB.KUB_coop_marlib_drift = KUB_coop_influence_var }
	
	set_variable = { KUB_coop_global_building_slots_factor = 0.1 }	
	
	# (from focus)
	if = {
		limit = {
			has_completed_focus = KUB_Rely_On_Cooperatives
		}
		add_to_variable = { KUB.KUB_coop_global_building_slots_factor = 0.1 }
	}
	if = {
		limit = {
			has_completed_focus = KUB_Seize_Tea_Industry
		}
		add_to_variable = { KUB.KUB_coop_global_building_slots_factor = 0.1 }
	}
	set_variable = { KUB.KUB_coop_radsoc_drift = 0.01 }
	set_variable = { KUB.KUB_coop_marlib_drift = 0.01 }

	# Maluses if above 24%
	if = {
		limit = {
			check_variable = { KUB_coop_influence_var < 0.25 }
			check_variable = { KUB_coop_influence_var > 0.199 }
		}
		set_variable = { KUB.KUB_coop_radsoc_drift = 0.03 }
		set_variable = { KUB.KUB_coop_marlib_drift = 0.03 }
	}
	else_if = {
		limit = {
			check_variable = { KUB_coop_influence_var < 0.2 }
			check_variable = { KUB_coop_influence_var > 0.149 }
		}
		set_variable = { KUB.KUB_coop_radsoc_drift = 0.05 }
		set_variable = { KUB.KUB_coop_marlib_drift = 0.05 }
	}
	else_if = {
		limit = {
			check_variable = { KUB_coop_influence_var < 0.15 }
			check_variable = { KUB_coop_influence_var > 0.099 }
		}
		set_variable = { KUB.KUB_coop_radsoc_drift = 0.06 }
		set_variable = { KUB.KUB_coop_marlib_drift = 0.06 }
	}
	else_if = {
		limit = {
			check_variable = { KUB_coop_influence_var < 0.1 }
			check_variable = { KUB_coop_influence_var > 0.049 }
		}
		set_variable = { KUB.KUB_coop_radsoc_drift = 0.07 }
		set_variable = { KUB.KUB_coop_marlib_drift = 0.07 }
	}
	else_if = {
		limit = {
			check_variable = { KUB_coop_influence_var < 0.049 }
		}
		set_variable = { KUB.KUB_coop_radsoc_drift = 0.08 }
		set_variable = { KUB.KUB_coop_marlib_drift = 0.08 }
	}

	clear_variable = KUB_coop_influence_var
	force_update_dynamic_modifier = yes
}

	
